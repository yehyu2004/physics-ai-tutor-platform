# 樂觀派提案：NTHU 物理 AI 家教平台新功能

> 提案角色：樂觀派 / 創新者 (Optimist / Innovator)
> 日期：2026-02-08
> 平台技術棧：Next.js 14 + Prisma 7 + PostgreSQL + OpenAI (GPT-5 Mini) / Anthropic (Claude 4.5 Haiku)

---

## 現有功能總覽

目前平台已具備：AI 聊天助教（支援 OpenAI / Anthropic 雙模型）、作業與測驗系統、自動評分、AI 輔助評分、題目生成、檔案上傳、管理後台、使用者角色控制（STUDENT / TA / ADMIN）、NTHU 網域限定的 Google OAuth 登入、使用者封鎖/限制機制（已有 migration）。

---

## 提案一：AI 自動濫用偵測系統

**功能名稱：** 智慧濫用偵測與自動管制系統

**描述：**
建立一套即時監控系統，運用規則引擎與 AI 內容分析雙重機制，自動偵測平台上的濫用行為。系統會追蹤每位使用者的行為模式——包括訊息頻率、內容性質、以及是否試圖繞過 AI 的物理教學範圍——並根據嚴重程度自動執行警告、限速、限制功能或暫時封鎖等分級處置。所有偵測事件都會記錄在管理後台中，供 ADMIN 審查及調整閾值。

**如何幫助學生學習：**
維護一個健康、專注的學習環境。當少數使用者濫用 AI 資源（例如大量灌水、提交不相關內容、嘗試 prompt injection）時，會消耗伺服器資源並可能影響其他學生的使用體驗。自動偵測系統能即時處理這些狀況，確保所有學生都能公平且順暢地使用平台。

**關鍵技術元件：**
- **`AbuseEvent` 資料模型**：紀錄濫用事件（userId、eventType、severity、description、actionTaken、timestamp）
- **`RateLimitRule` 資料模型**：可配置的限速規則（每分鐘訊息上限、每日對話上限等）
- **規則引擎中介層**：在 `/api/chat` 等路由前加入 middleware，檢查：
  - 訊息發送頻率（例：每分鐘 > 10 則觸發限速）
  - 每日 API 呼叫總量（例：每日 > 200 則通知管理員）
  - 重複內容偵測（cosine similarity 或簡單字串比對）
- **AI 內容分類器**：利用現有的 OpenAI / Anthropic API，對可疑訊息進行分類：
  - 是否為物理相關問題
  - 是否包含不當內容
  - 是否嘗試 prompt injection（例如「忽略以上指令」）
- **分級處置邏輯**：
  - Level 1：系統內警告提示
  - Level 2：限速（降低訊息頻率上限）
  - Level 3：暫時限制功能（`isRestricted = true`，已有欄位）
  - Level 4：暫時封鎖（`isBanned = true`，已有欄位）
- **管理後台儀表板**：濫用事件列表、趨勢圖表、閾值調整介面

**潛在挑戰：**
- 誤判問題：正常學生密集使用（如考前衝刺）可能被誤判為濫用，需要仔細調整閾值並提供申訴機制
- AI 內容分類的額外 API 成本：每次分類都會消耗 token，需考慮只對可疑訊息觸發 AI 分析
- 隱私考量：監控學生對話內容需要明確的使用條款告知

---

## 提案二：蘇格拉底式引導對話模式

**功能名稱：** 蘇格拉底式物理引導模式 (Socratic Physics Mode)

**描述：**
在現有的 AI 聊天功能中新增「引導模式」開關。啟用後，AI 不會直接給出完整答案，而是透過一系列精心設計的引導性問題，帶領學生一步步推導出答案。系統會根據學生的回應動態調整引導方向：若學生走對方向則鼓勵深入，若偏離則溫和引導回正軌。每次引導結束後，AI 會總結學生的推理過程並指出優缺點。

**如何幫助學生學習：**
物理學習的核心不是背公式，而是建立物理直覺和獨立解題能力。蘇格拉底式教學法迫使學生主動思考每一個步驟，而非被動接收答案。研究顯示，這種主動式學習（active learning）能顯著提高概念理解和長期記憶。對於 NTHU 普物學生而言，這能幫助他們在考試時面對變形題目時仍能獨立分析。

**關鍵技術元件：**
- **對話模式旗標**：在前端聊天介面增加模式切換（Normal / Socratic），將模式傳遞至 `/api/chat`
- **專用 System Prompt**：為蘇格拉底模式設計獨立的 system prompt，指導 AI：
  - 不直接給答案，改用提問引導
  - 偵測學生是否理解當前步驟再前進
  - 在適當時機提供小提示（hints）
  - 對話結束時生成學習摘要
- **引導進度追蹤**：在 `Message` 模型中增加 metadata 欄位，記錄當前引導階段
- **學習摘要生成**：每次蘇格拉底對話結束時，自動生成一份結構化的學習摘要（使用了哪些觀念、哪裡卡住、最終是否理解）

**潛在挑戰：**
- Prompt 工程難度高：要讓 AI 穩定地執行蘇格拉底式教學而不「漏答案」需要大量測試和迭代
- 學生可能感到挫折：習慣直接得到答案的學生可能覺得這個模式「很煩」，需要良好的 UX 設計讓學生理解這是為了他們好
- 對話輪次增加導致 token 消耗上升

---

## 提案三：個人化學習弱點分析與推薦系統

**功能名稱：** 物理學習弱點地圖與智慧推薦

**描述：**
系統自動分析每位學生在作業、測驗和 AI 對話中的表現數據，建構出個人化的「物理知識地圖」。地圖上標示出學生在各物理主題（力學、電磁學、熱力學、光學、近代物理）及其子主題上的掌握程度。根據弱點區域，系統自動推薦對應的練習題目、相關 AI 對話主題、以及建議複習的概念。

**如何幫助學生學習：**
每個學生的弱點不同——有人不擅長向量分析，有人搞不懂電路。統一的教學無法照顧到每個人的需求。透過數據驅動的弱點分析，學生能清楚看到自己需要加強的地方，而推薦系統則確保他們的學習時間花在最有效益的地方。這實現了真正的「因材施教」。

**關鍵技術元件：**
- **`TopicTag` 資料模型**：物理主題標籤系統（topic, subtopic, chapter），與 `AssignmentQuestion` 關聯
- **`StudentTopicMastery` 資料模型**：記錄每位學生在各主題的掌握度（userId, topicId, masteryScore 0-100, lastAssessedAt, questionCount）
- **掌握度計算引擎**：
  - 從測驗與作業的得分計算各主題的正確率
  - 從 AI 對話中利用 AI 分類提取討論主題與理解程度
  - 採用加權移動平均，近期表現權重較高
- **推薦演算法**：
  - 優先推薦掌握度低於 60% 的主題
  - 結合作業截止日期推薦即時需要的主題
  - 呼叫現有的 `generateProblems` API 自動生成推薦題目
- **前端視覺化**：使用雷達圖或熱力圖呈現知識地圖（可用 Mermaid 或整合 Chart.js）

**潛在挑戰：**
- 冷啟動問題：新學生沒有足夠數據時無法準確分析，需要設計初始評估機制
- 主題標籤的維護成本：需要 TA 或 ADMIN 為題目標記主題，或使用 AI 自動標記
- 掌握度模型的準確性：簡單的正確率可能不夠精確，但作為 MVP 已經足夠有用

---

## 提案四：解題過程即時回饋系統

**功能名稱：** 解題步驟即時 AI 回饋 (Step-by-Step Feedback)

**描述：**
學生在作答 `FREE_RESPONSE` 類型的題目時，可以選擇逐步提交自己的解題過程（而非一次提交最終答案）。每提交一個步驟，AI 會即時檢查該步驟的正確性、物理觀念的應用是否恰當、以及數學推導是否合理，並給予即時回饋。若學生在某一步驟犯錯，系統會提供提示但不直接修正，讓學生有機會自行修正後繼續。

**如何幫助學生學習：**
物理解題最大的痛點是「不知道自己錯在哪裡」。傳統作業批改只看最終答案，學生即使拿到回饋也不記得自己當時的思路了。即時的步驟回饋讓學生在解題當下就能發現錯誤、修正觀念，大幅縮短「犯錯到修正」的回饋迴圈。這也模擬了和助教一對一討論的體驗，但全天候可用。

**關鍵技術元件：**
- **`SolutionStep` 資料模型**：記錄解題步驟（submissionAnswerId, stepNumber, content, aiFeedback, isCorrect, createdAt）
- **步驟提交 API**：`/api/submissions/[id]/steps` - POST 提交新步驟、GET 取得步驟歷史
- **AI 步驟評估**：利用現有 AI 模組，根據題目內容、正確答案和已提交的前序步驟，評估當前步驟：
  - 物理原理是否正確
  - 數學運算是否無誤
  - 是否遺漏重要步驟
  - 方向是否正確（即使當前步驟正確，但走向死路也要提醒）
- **前端互動介面**：類似 Jupyter Notebook 的分步輸入介面，每個步驟旁顯示 AI 回饋
- **KaTeX 支援**：充分利用現有的 `react-katex` 套件渲染數學公式

**潛在挑戰：**
- AI 評估解題步驟比評估最終答案困難得多，特別是當學生使用非標準但仍正確的解法時
- API 呼叫頻率高：每個步驟都需要一次 AI 呼叫，需要與濫用偵測系統整合做限速
- 需要為不同題型（力學、電磁學等）提供適當的 context，才能讓 AI 給出精確回饋

---

## 提案五：AI 驅動的考前模擬系統

**功能名稱：** 智慧考前模擬與限時測驗 (AI Mock Exam)

**描述：**
整合現有的題目生成功能，建立完整的模擬考系統。學生可以選擇考試範圍（例如「期中考：牛頓力學 + 功與能量」），系統會根據選定範圍自動生成一份模擬考卷，包含多種題型（選擇題、計算題、簡答題），並以限時模式進行。考試結束後，系統即時批改並生成詳細的檢討報告——不僅告訴學生分數，還會分析每題錯誤的原因、對應的觀念缺陷、以及推薦的複習方向。

**如何幫助學生學習：**
考前練習是最有效的學習策略之一（retrieval practice）。但 NTHU 普物的考古題數量有限，且缺乏即時的批改和分析。AI 模擬考提供了無限的練習機會，且每次生成的題目都不同，避免了「背考古題」而非真正理解的問題。限時模式還能幫助學生適應考試壓力。

**關鍵技術元件：**
- **`MockExam` 資料模型**：模擬考記錄（userId, topics[], timeLimit, startedAt, completedAt, totalScore）
- **`MockExamQuestion` 資料模型**：連結 MockExam 與動態生成的題目
- **考卷生成引擎**：
  - 擴展現有 `generateProblems` API，支援多主題混合出題
  - 根據選定難度分配題目（簡單 30%、中等 50%、困難 20%）
  - 確保題型均衡分布
- **限時機制**：
  - 前端倒數計時器
  - 後端驗證提交時間（`startedAt + timeLimit >= submittedAt`）
  - 超時自動提交
- **檢討報告生成**：考試結束後，呼叫 AI 生成綜合分析報告，包含：
  - 各主題得分率
  - 逐題錯誤原因分析
  - 概念缺陷指認
  - 推薦練習方向

**潛在挑戰：**
- AI 生成的題目品質參差不齊：需要建立題目品質驗證機制，或允許 TA 預先審核題庫
- 計算題的自動評分準確性：`NUMERIC` 類型相對容易，但 `FREE_RESPONSE` 的自動評分可能不夠精確
- 模擬考的難度校準：確保 AI 生成的題目與 NTHU 普物實際考試難度匹配

---

## 提案六：協作學習討論區

**功能名稱：** 物理學習社群討論區 (Physics Forum)

**描述：**
建立以物理主題為核心的討論區功能，學生可以發起問題討論、分享解題心得、互相回答問題。每篇討論可附上 LaTeX 公式和圖片。討論區整合 AI 功能：當一個問題長時間沒有人回答時，AI 會自動生成一個引導性的回覆；TA 可以將優質討論標記為「精華」供其他學生參考。系統也會根據學生的知識地圖，推薦他們可能有能力回答的問題。

**如何幫助學生學習：**
「教是最好的學」——當學生嘗試回答其他同學的問題時，他們需要組織自己的理解、用清晰的語言表達，這個過程本身就是深度學習。討論區也營造了一個學習社群感，減少學生獨自面對困難物理問題時的孤立感。對於不好意思問 TA 的學生，匿名討論（可選）提供了一個更舒適的求助管道。

**關鍵技術元件：**
- **`ForumPost` 資料模型**：討論貼文（userId, title, content, topicTag, isPinned, isResolved, upvoteCount, createdAt）
- **`ForumReply` 資料模型**：回覆（postId, userId, content, isAccepted, isTAVerified, upvoteCount）
- **`ForumVote` 資料模型**：投票記錄（userId, targetId, targetType, value）
- **API 路由**：
  - `/api/forum` - GET（列表含篩選、排序）、POST（發文）
  - `/api/forum/[id]` - GET、PATCH、DELETE
  - `/api/forum/[id]/replies` - GET、POST
  - `/api/forum/[id]/vote` - POST
- **AI 自動回覆排程**：使用 Next.js API route + cron job（或 Vercel Cron），定期檢查超過 24 小時未回覆的問題，由 AI 生成引導性回覆
- **KaTeX 渲染**：複用現有的 `react-katex` 支援，確保討論中的公式正確顯示
- **推薦引擎**：根據學生的 `StudentTopicMastery` 推薦他們擅長的主題的問題

**潛在挑戰：**
- 初期使用率低：學生可能不習慣在課程平台上討論，需要 TA 帶頭參與和適當的激勵機制
- 內容品質控制：需要結合濫用偵測系統防止灌水、與 TA 審核機制確保回答品質
- 排名/聲望系統可能帶來的負面競爭：需要謹慎設計

---

## 提案七：學習歷程視覺化儀表板

**功能名稱：** 個人學習歷程儀表板 (Learning Dashboard)

**描述：**
為每位學生提供一個視覺化的學習儀表板，呈現他們在平台上所有學習活動的綜合分析。包括：AI 對話的主題分布與頻率趨勢、作業與測驗的成績走勢、各物理主題的掌握度變化、學習時間分布、以及與班級平均的匿名化比較。TA 和 ADMIN 也能看到班級層級的彙總統計，用於調整教學策略。

**如何幫助學生學習：**
後設認知（metacognition）——也就是「知道自己知道什麼、不知道什麼」——是高效學習的關鍵。視覺化儀表板讓學生具體看到自己的學習軌跡，發現自己可能沒注意到的模式（例如：「原來我每次電磁學的作業都拖到最後一天才寫」、「我的力學成績穩定進步了」）。這種自我覺察能幫助學生主動調整學習策略。

**關鍵技術元件：**
- **數據聚合 API**：
  - `/api/dashboard/student` - 個人學習數據彙整
  - `/api/dashboard/class` - 班級統計（TA/ADMIN 限定）
- **數據來源整合**：
  - 從 `Conversation` + `Message` 提取對話統計
  - 從 `Submission` + `SubmissionAnswer` 提取成績數據
  - 從 `StudentTopicMastery`（提案三）提取掌握度數據
- **前端圖表元件**：
  - 成績走勢折線圖
  - 主題掌握度雷達圖
  - 學習活動日曆熱力圖（類似 GitHub contribution graph）
  - 班級排名分布直方圖（匿名化）
- **定期數據快照**：每日計算並快取統計數據，避免即時查詢的效能問題
- **可利用現有 Mermaid 套件**做部分圖表，或引入 `recharts` / `chart.js`

**潛在挑戰：**
- 數據量增長後的查詢效能：需要適當的索引和資料聚合策略
- 班級比較功能的隱私問題：必須確保完全匿名化，避免學生互相對照出身份
- 圖表過多可能讓學生資訊超載：需要精心設計 UI 層級，預設顯示最關鍵的指標

---

## 提案八：AI 概念圖與公式關聯圖自動生成

**功能名稱：** 智慧物理概念關聯圖 (Physics Concept Map Generator)

**描述：**
學生在學習某個物理主題時，可以請 AI 自動生成該主題的概念關聯圖——以視覺化的方式呈現概念之間的邏輯關係、相關公式、以及它們的適用條件。例如，學習「圓周運動」時，系統會生成一張圖，連結向心加速度、向心力、角速度、切線速度、週期等概念，並標示出關鍵公式和它們之間的推導關係。學生也可以在 AI 對話中直接請求生成特定主題的概念圖。

**如何幫助學生學習：**
物理學的知識體系是高度結構化的，但學生往往只看到一個個孤立的公式。概念關聯圖幫助學生建立「全局觀」——看到概念之間的連結和層次關係，而不只是死記硬背個別公式。這種結構化的理解是解決複雜物理問題的基礎，因為複雜問題往往需要跨概念的整合。

**關鍵技術元件：**
- **概念圖生成 API**：`/api/concept-map/generate` - 接受主題名稱，回傳 Mermaid 格式的概念圖
- **AI Prompt 設計**：指導 AI 輸出結構化的概念關聯：
  - 節點：概念名稱 + 核心公式
  - 邊：關係類型（推導、特例、相關、前置知識）
  - 適用條件標註
- **Mermaid 渲染**：充分利用現有已安裝的 `mermaid` 套件渲染互動式概念圖
- **概念圖儲存**：`ConceptMap` 資料模型（userId, topic, mermaidCode, createdAt），讓學生保存和回顧
- **對話整合**：在 AI 聊天中偵測到學生在探索某個主題時，主動建議生成概念圖
- **可編輯性**：學生可以在 AI 生成的基礎上修改概念圖，添加自己的理解

**潛在挑戰：**
- Mermaid 語法的限制：複雜的概念關係可能超出 Mermaid 的表達能力，需要妥善處理
- AI 生成的概念圖可能不完整或有錯誤：需要提供 TA 審核或社群修正的機制
- 公式在 Mermaid 圖中的渲染：Mermaid 對 LaTeX 的支援有限，可能需要 workaround

---

## 功能優先序建議

| 優先順序 | 功能 | 理由 |
|---------|------|------|
| P0 (必要) | AI 自動濫用偵測系統 | 使用者明確需求 + 平台安全基礎設施 |
| P1 (高) | 蘇格拉底式引導對話模式 | 直接提升學習品質、技術複雜度相對低（主要是 prompt 工程） |
| P1 (高) | 解題過程即時回饋系統 | 解決學生最大痛點、充分利用現有 AI 基礎設施 |
| P2 (中) | AI 考前模擬系統 | 基於現有題目生成功能的自然延伸 |
| P2 (中) | 個人化弱點分析與推薦 | 需要較多數據累積，但長期價值極高 |
| P2 (中) | 學習歷程視覺化儀表板 | 與弱點分析系統互補，提供自我覺察工具 |
| P3 (低) | 協作學習討論區 | 功能完整度要求高、需要社群營運 |
| P3 (低) | 概念圖自動生成 | 創新但非核心需求、可利用現有 Mermaid 快速 MVP |

---

## 技術架構考量

**跨功能共用元件：**
- AI 呼叫的統一抽象層（現有 `lib/ai.ts` 需擴展）
- 物理主題標籤系統（提案三、五、六、八共用）
- 使用者行為追蹤中介層（提案一、七共用）

**資料庫影響：**
- 預計新增 8-12 個 Prisma model
- 需要加入適當的索引策略，特別是對 `userId` + `topicId` 的複合索引
- 考慮對歷史數據使用 PostgreSQL 的分區（partitioning）功能

**API 成本估算：**
- 濫用偵測：每日約 50-200 次額外 AI 呼叫（僅對可疑訊息）
- 蘇格拉底模式：每次對話的 token 消耗約為普通模式的 2-3 倍
- 步驟回饋：每個步驟約 500-1000 tokens
- 模擬考報告：每份報告約 2000-3000 tokens
- 概念圖生成：每張約 500-800 tokens

---

> 以上八項功能，從平台安全（濫用偵測）到深度學習支援（蘇格拉底式教學、步驟回饋）到學習分析（弱點地圖、儀表板）到社群協作（討論區）再到知識視覺化（概念圖），形成了一個完整的學習生態系統。每項功能都基於現有技術棧可實現，並充分利用了平台已有的 AI 基礎設施。
